rscreen	=	$3b00
x_step	=	4
y_step	=	4

	PEA	0.W	
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	MOVE.L	D0,OLDSP
	LEA	STACK,A7
	BSR	SAVE_INTS
	BSR	INSTALL_INTS
	MOVE.B	$FFFF8260.W,OLD_REZ
	CLR.B	$FFFF8260
	MOVEM.L	$FFFF8240,D0-D7
	MOVEM.L	D0-D7,OLD_PAL
	JSR	VSYNC
*	LEA	$FFFF8240.W,A0
*	MOVEQ	#15,D0
*DARK
*	CLR.W	(A0)+
*	DBF	D0,DARK
*	MOVE.B	#$12,$FFFFC02

	BSR	CLS_SCREEN
	BSR	AFF_PIC
	MOVE.W	#80,IND_X
	MOVE.W	#150,IND_Y
	BSR	SETSCREEN

KEY
	MOVE.B	$FFFFC02,D0
	CMP.B	#$39,D0
	BEQ	SORTIE
	CMP.B	#$3B,D0
	BEQ	LEFT
	CMP.B	#$3C,D0
	BEQ	RIGHT
	CMP.B	#$3D,D0
	BEQ	UP
	CMP.B	#$3E,D0
	BEQ	DOWN
	BRA.S	KEY
********************INITIALISATIONS**************************************************
SAVE_INTS
	MOVE.W	SR,-(SP)	
	MOVE.W	#$2700,SR
	MOVE.B	$FFFFFFA07.W,MFP1
	MOVE.B	$FFFFFFA09.W,MFP2
	MOVE.L	$70,OLD_VBL
	MOVE.L	$118.W,OLDIKBD
	MOVE.L	$120.W,OLDTB
	MOVE.W	(SP)+,SR
	RTS
RESTORE_INTS
	MOVE.W	SR,-(SP)
	MOVE.W	#$2700,SR
	MOVE.B	MFP1,$FFFFFFA07.W
	MOVE.B	MFP2,$FFFFFFA09.W
	MOVE.L	OLD_VBL,$70.W
	MOVE.L	OLDIKBD,$118.W
	MOVE.L	OLDTB,$120.W
	MOVE.W	(SP)+,SR
	RTS
INSTALL_INTS
	MOVE.W	SR,-(SP)
	MOVE.W	#$2700,SR
	CLR.B	$FFFFFFA07.W
	CLR.B	$FFFFFFA09.W
	MOVE.L	#NEW_VBL,$70.W
	MOVE.L	#NEWIKBD,$118.W
	MOVE.L	OLDIKBD,NEWIKBD1+4
	MOVE.L	#NEWTB,$120.W
	MOVE.W	(SP)+,SR
	RTS
********************SOUS ROUTINES****************************************************
AFF_PIC
	LEA	IMAGE+34,A0
	LEA	RSCREEN,A2
	LEA	320*100(A2),A2
	MOVE.W	#199,D1
LD_0
	MOVEQ	#19,D0
LD_1
	MOVE.L	(A0)+,(A2)+
	MOVE.L	(A0)+,(A2)+
	DBRA	D0,LD_1
	LEA	160(A2),A2
	DBRA	D1,LD_0	

*	LEA	IMAGE2+34,A0
*	LEA	RSCREEN,A2
*	LEA	320*100(A2),A2
*	MOVE.W	#199,D1
*LD_0
*	MOVEQ	#19,D0
*LD_1
*	MOVE.L	(A0)+,(A2)+
*	MOVE.L	(A0)+,(A2)+
*	DBRA	D0,LD_1
*	LEA	160(A2),A2
*	DBRA	D1,LD_0	
	RTS
CLS_SCREEN
	LEA	RSCREEN,A0
	MOVE.W	#40*300-1,D0
	MOVEQ.L	#0,D2
LOOP1
	MOVE.L	D2,(A0)+
	MOVE.L	D2,(A0)+
	DBRA	D0,LOOP1
	RTS
SETSCREEN				;positionne l'ecran
	MOVE.W	IND_X,D0
	MOVE.W	D0,D1
	LSR	D0
	AND.L	#$FFF8,D0
	AND.W	#$F,D1
	MOVE.W	IND_Y,D2
	MULU	#320,D2
	ADD.L	D0,D2
	ADD.L	#RSCREEN,D2
	MOVE.L	D2,STAMP
	LEA	STAMP,A0
	TST.W	D1			;si HSCROLL<>0
	BNE.S	OUT
	JSR	VSYNC
	MOVE.B	1(A0),$FFFF8205.W
	MOVE.B	2(A0),$FFFF8207.W
	MOVE.B	3(A0),$FFFF8209.W
	MOVE.B	#80,$FFFF820F.W		;ligne de 320 pix
	MOVE.B	D1,$FFFF8265.W
	MOVE.B	1(A0),$FFFF8201.W	;base ecran
	MOVE.B	2(A0),$FFFF8203.W
	MOVE.B	3(A0),$FFFF820D.W
	RTS
OUT
	JSR	VSYNC
	MOVE.B	1(A0),$FFFF8205.W
	MOVE.B	2(A0),$FFFF8207.W
	MOVE.B	3(A0),$FFFF8209.W
	MOVE.B	#80-4,$FFFF820F.W
	MOVE.B	D1,$FFFF8265.W		
	MOVE.B	1(A0),$FFFF8201.W	;base ecran
	MOVE.B	2(A0),$FFFF8203.W
	MOVE.B	3(A0),$FFFF820D.W
	RTS	
*****
LEFT
	SUBQ.W	#X_STEP,IND_X
	BPL	OK1
	CLR.W	IND_X
	BRA	OK1
RIGHT
	ADDQ.W	#X_STEP,IND_X
	CMP.W	#319,IND_X
	BLE	OK1
	MOVE.W	#319,IND_X
	BRA	OK1
UP
	SUBQ.W	#Y_STEP,IND_Y
	BPL	OK1
	CLR.W	IND_Y
	BRA	OK1
DOWN
	ADDQ.W	#Y_STEP,IND_Y
	CMP.W	#199,IND_Y
	BLE	OK1
	MOVE.W	#199,IND_Y
OK1
	BSR	SETSCREEN
	BRA	KEY
*****
NEW_VBL
	CLR.B	$FFFFFFA1B.W
	ADDQ.L	#1,$466.W
	RTE
NEWIKBD
	MOVE.W	#$2300,SR
NEWIKBD1
	JMP	$00000000.L
	RTE
NEWTB
	CLR.B	$FFFFFA1B.W
	BCLR	#0,$FFFFFA0F0.W
	RTE
*****	
VSYNC
	MOVE.L	D0,-(SP)
	MOVE.L	$466.W,D0
WAIT
	CMP.L	$466,D0
	BEQ.S	WAIT
	MOVE.L	(SP)+,D0
	RTS
*****	
SORTIE
	JSR	VSYNC
	BSR	RESTORE_INTS
	MOVE.B	#8,$FFFFC02
	CLR.W	$FFFF820E.W
	CLR.W	$FFFF8264.W
	MOVE.B	OLD_REZ,$FFFF8260.W
	MOVEM.L	OLD_PAL,D0-D7
	MOVEM.L	D0-D7,$FFFF8240.W
	MOVE.L	OLDSP,-(SP)	
	MOVE.W	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP
	CLR.W	-(SP)
	TRAP	#1

	SECTION	DATA
IMAGE	INCBIN	"E:\GRAPHS\HYDROXID.PI1\NYTRIK\GROSNAIN.PI1"
	SECTION	BSS
	DS.L	2000
STACK	DS.L	256
OLDSP	DS.L	1
OLD_PAL	DS.W	16
OLD_VBL	DS.L	1
OLDIKBD	DS.L	1
OLDTB	DS.L	1
MFP1	DS.B	1
MFP2	DS.B	1
IND_X	DS.W	1
IND_Y	DS.W	1
STAMP	DS.L	1
OLD_REZ	DS.W	1
INDWAY	DS.W	1
NAMER	DS.L	1
NLOG1	DS.W	1
LENGHT	DS.L	1
ZONE	DS.L	1
ZONE1	DS.B	32*1024
	END	
	 