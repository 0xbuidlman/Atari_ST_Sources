* FUN WITH THE FALCON'S RESOLUTION
	OPT	D+

	CLR.L	-(SP)
	MOVE	#32,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

	BSR	VBL
	MOVE	#256,$FFFF8266.W
	CLR.B	$FFFF8260.W
* INIT OVERSCAN
	move	#464,$FFFF8210.w	;VIRTUELLE LINEWIDTH
* 80 MOTS POUR UNE REZO DE 320 PIXELS SOIT 160 OCTETS
* 116 MOTS POUR DE L'OVERSCAN SOIT 464 PIXELS SOIT 232 OCTETS
* EN TRUE COLOR=928 OCTETS SOIT 464 MOTS (65536 COULEURS!!!)
	move	#50,$FFFF82A8.w	;OVER HAUT
	move	#611,$FFFF82AA.w	;BAS
	move	#566,$FFFF8288.w	;OVER GAUCHE
	move	#50,$FFFF828A.w	;OVER DROIT

	BSR	INITS
	BSR	SYNCHRO
	BSR	CLS
	BSR	VBL

	MOVE.L	AFFECR,A0
	MOVE.L	#464*141,D0
	MOVE	#$8F8,D1
LOOP2:
	ADD	#4096,D1
	MOVE	D1,(A0)+
	DBF	D0,LOOP2
	SUB	#34,A0
	MOVE.L	#0,D1
	MOVE.L	#464*141,D0
LOOP3:
	ADD	#4096,D1
	MOVE	D1,(A0)+
	DBF	D0,LOOP3

BOUCLE:
	BSR	VBL

	CMPI.B	#57,$FFFFC02
	BNE	BOUCLE

* RESTITUE BORDER HAUT & BAS
FIN:	BSR	VBL
	MOVE	#0,$FFFF8266
	MOVE.B	#1,$FFFF8260
	MOVE	#111,$FF82A8
	MOVE	#511,$FF82AA
	MOVE	#625,$FFFF82A2	;NBRE DE CHAMPS
	MOVE	#575,$FFFF8288
	MOVE	#28,$FFFF828A
	MOVE	#4,$FFF82C2
	MOVE	#80,$FF8210
	MOVE	#$777,$FFFF8240.W
	CLR	$FFFF8246.W	

	BSR	CLS
	BSR	VBL
	MOVE	#-1,-(SP)
	move.l	OLDXBIOS,-(sp)
	move.l	OLDXBIOS,-(sp)
	MOVE	#5,-(SP)
	TRAP	#14
	LEA	12(SP),SP		
	BSR	CLS 

	CLR.L	-(SP)
	MOVE	#32,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

	CLR.L	-(SP)
	TRAP	#1

VBL:
	MOVE.L	D0,-(SP)
	move.l	$466.w,d0		
VSYNC:	cmp.l	$466.w,d0
	BEQ.S	VSYNC
	MOVE.L	(SP)+,D0
	RTS

INITS:
	move.l	$44E.W,OLDXBIOS
	
	MOVE.L	$44E.W,WORKECR
	MOVE.L	#XBIOS3+256,D0
	ANDI.L	#$FFFFFF00,D0
	MOVE.L	D0,AFFECR
	RTS

SYNCHRO:
	*MOVE.L	AFFECR,A5
	*MOVE.L	WORKECR,A6
	*EXG	A5,A6
	*MOVE.L	A5,AFFECR
	*MOVE.L	A6,WORKECR

	move.b AFFECR+1,$ffff8201.w
	move.b AFFECR+2,$ffff8203.w
	RTS

CLS:
	MOVE.L	AFFECR,A0
	MOVE.L	#14000,D0
LOOP_CLS:
	CLR.L	(A0)+
	DBF	D0,LOOP_CLS
	RTS

	SECTION	DATA

OLDXBIOS:	DC.L	0
AFFECR:	DC.L	0
WORKECR:	DC.L	0

	SECTION	BSS
XBIOS3:	DS.B	928*400

