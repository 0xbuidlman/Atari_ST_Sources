;	Dotscroller by Fredrik Egeberg (Deez)
;
;	Feel free to use this source
;
;
;	If you want to contact me here is my address...
;
;	Fredrik Egeberg
;	Hasselgatan 22
;	614 33 S”derk”ping
;	SWEDEN


start	clr.l	-(sp)			; Enter Supervisor mode
	move.w	#32,-(sp)
	trap	#1
	addq.l	#2,sp
	move.l	d0,super
	bclr	#0,$484.w		; Get rid of the fuckin' keyclick
	dc.w	$a00a			; Hide mousepointer

	move.w	#0,-(sp)
	move.l	#-1,-(sp)
	move.l	#-1,-(sp)
	move.w	#5,-(sp)
	trap	#14
	add.l	#12,sp

	move.l	#$70000,a1		; Erase both screens
	jsr	clr_scr
	move.l	#$78000,a1
	jsr	clr_scr

	movem.l	$ff8240,d0-d7		; Install new palette
	movem.l	d0-d7,oldpal
	movem.l	palett,d0-d7
	movem.l	d0-d7,$ff8240

	lea.l	dot_dat,a1
	move.l	#0,a2
	moveq	#20,d0
	move.w	#$8000,d1
.c	rept	16
	move.l	a2,(a1)+
	move.w	d1,(a1)+
	adda.l	#2,a1
	lsr.w	d1
	endr
	adda.l	#8,a2
	move.w	#$8000,d1
	dbra	d0,.c
	clr.l	d0
	clr.l	d1

	lea.l	dot_dat,a0
	adda.l	#2560,a0
	move.w	#199,d0
	move.w	#0,d1
.c1	move.w	d1,(a0)+
	add.w	#160,d1
	dbra	d0,.c1

	move.l	$70.w,oldvbi		; Save old vbi vector
	move.l	#vbi,$70.w		; Install new one

	jsr	precalc_scroller_buffer

	clr.b	vbiflag
main	jsr	tst_scr
.vbl	cmp.b	#1,vbiflag
	bne.s	.vbl
	clr.b	vbiflag
	jsr	dot
	cmp.b	#1,$fffc02		; Somebody pressed <ESC>?
	bne.s	main			; If not so back to Main

restore	move.l	oldvbi,$70.w
	movem.l	oldpal,d0-d7		; Restore old palette
	movem.l	d0-d7,$ff8240

	move.l	super,-(sp)		; Back into User mode
	move.w	#32,-(sp)
	trap	#1
	addq.l	#6,sp

	clr.w	-(sp)			; Quit program
	trap	#1

;	Here are all the subroutines

vbi	move.b	#1,vbiflag
	rte

swap1	move.w	#-1,-(sp)		; Swap screens
	move.l	#$78000,-(sp)
	move.l	#$70000,-(sp)
	move.w	#5,-(sp)
	trap	#14
	add.l	#12,sp
	move.l	#$70000,screen
	rts

swap2	move.w	#-1,-(sp)		; Swap screens
	move.l	#$70000,-(sp)
	move.l	#$78000,-(sp)
	move.w	#5,-(sp)
	trap	#14
	add.l	#12,sp
	move.l	#$78000,screen
	rts

tst_scr	cmpi.l	#$78000,screen
	bne.s	swp_2
	jsr	swap1
	rts
swp_2	jsr	swap2
	rts

waitvbl	move.w	#37,-(sp)		; Wait for Vertical Blank
	trap	#14
	addq.l	#2,sp
	rts

precalc_scroller_buffer
	lea.l	buffer,a0
	lea.l	text,a2

go	lea.l	tecken,a1
	clr.l	d0
	move.b	(a2)+,d0
	beq.s	no_more_chars
	sub.w	#65,d0
	bpl.s	.not_space
	lea.l	space,a1
	move.w	#0,d0
.not_space
	mulu.w	#100,d0
	add.w	d0,a1
	jsr	put_chr
	add.w	#20,a0
	bra	go
no_more_chars
	rts

put_chr	move.w	#9,d7
	clr.l	d3
.run	
val	set	0
	rept	10
	move.b	val(a1,d3),(a0)+
val	set	val+10
	endr
	addq.w	#1,d3
	add.w	#10,chars
	dbra	d7,.run
	rts

dot	lea.l	buffer,a3
	add.w	offset,a3
	move.w	#79,d7
	move.w	#0,d0
	lea.l	scroll_path,a2
	lea.l	dot_dat(pc),a0
.go	move.w	(a2)+,d1
	move.l	(a0,d0),a1
	move.w	4(a0,d0),d3
	add.w	d1,a1
	adda.l	screen,a1
val	set	0
	rept	10
	move.b	(a3)+,d2
	dc.w	$6706			; beq.s	.zero
	or.w	d3,val(a1)
	dc.w	$6008			; bra.s	.one
;.zero
	not.w	d3
	and.w	d3,val(a1)
	not.w	d3
;.one
val	set	val+640
	endr
	add.w	#32,d0
	dbra	d7,.go
	add.w	#10,offset
	move.w	offset,d0
	cmp.w	chars,d0
	blt.s	.less
	move.w	#0,offset
.less	rts

clr_scr	move.w	#40*200,d0		; Clear whole screen,
clr	clr.l	(a1)+			; all 4 bitplanes
	dbra	d0,clr
	rts

	section	data
super	dc.l	0
screen	dc.l	$f8000
xp	dc.w	0
yp	dc.w	0
oldvbi	dc.l	0
vbiflag	dc.b	0
offset	dc.w	0
palett	dc.w	$000,$777,$555,$444,$222,$555,$666,$777
	dc.w	$007,$017,$027,$037,$047,$057,$067,$777
scroll_path
	dc.w	6400,7360,8320,9120,10080,11040,11840,12480,13120,13600,14080,14400,14560,14720,14560,14400,14240,13920,13440,12960,12320,12000,11360,10560,9920,9280,8800,8160,7680,7200,6720,6560,6400,6240,6240,6400,6560,6880
	dc.w	7360,7680,8320,8800,9440,10080,10880,11680,12160,12960,13600,14240,14720,15040,15520,15840,16000,16000,15840,15680,15520,15040,14400,13920,13120,12480,11520,10560,9600,8640,7680,6720,5600,4640,3840,3040,2240
	dc.w	1440,800,320,0,0
text	dc.b	'        THIS IS A SCROLLER CODED BY FREDRIK EGEBERG ALIAS DEEZ                        ',0
chars	dc.w	0
space	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0
	dc.b	0,0,0,0,0,0,0,0,0,0

tecken	dc.b	0,0,1,1,1,1,1,1,0,0		; A
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	1,1,1,1,1,1,1,1,0,0		; B
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,1,1,1,1,1,0,0

	dc.b	0,0,1,1,1,1,1,1,0,0		; C
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0

	dc.b	1,1,1,1,1,1,1,1,0,0		; D
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,1,1,1,1,1,0,0

	dc.b	1,1,1,1,1,1,1,1,1,1		; E
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,1,1,1,1,0,0,0,0
	dc.b	1,1,1,1,1,1,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1

	dc.b	1,1,1,1,1,1,1,1,1,1		; F
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,1,1,1,1,0,0,0,0
	dc.b	1,1,1,1,1,1,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0

	dc.b	0,0,1,1,1,1,1,1,0,0		; G
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,1,0,0,0,0,0,1,1
	dc.b	0,1,1,1,1,1,1,1,1,1
	dc.b	0,0,1,1,1,1,1,1,1,1

	dc.b	1,1,0,0,0,0,0,0,1,1		; H
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	1,1,1,1,1,1,1,1,1,1		; I
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1

	dc.b	0,0,0,0,0,0,0,0,1,1		; J
	dc.b	0,0,0,0,0,0,0,0,1,1
	dc.b	0,0,0,0,0,0,0,0,1,1
	dc.b	0,0,0,0,0,0,0,0,1,1
	dc.b	0,0,0,0,0,0,0,0,1,1
	dc.b	0,0,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0

	dc.b	1,1,0,0,0,0,0,1,1,1		; K
	dc.b	1,1,0,0,0,0,1,1,1,0
	dc.b	1,1,0,0,0,1,1,1,0,0
	dc.b	1,1,0,0,1,1,1,0,0,0
	dc.b	1,1,1,1,1,1,0,0,0,0
	dc.b	1,1,1,1,1,1,0,0,0,0
	dc.b	1,1,0,0,1,1,1,0,0,0
	dc.b	1,1,0,0,0,1,1,1,0,0
	dc.b	1,1,0,0,0,0,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1

	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1

	dc.b	1,1,0,0,0,0,0,0,1,1		; M
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,1,1,0,0,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,0,1,1,1,1,0,1,1
	dc.b	1,1,0,0,1,1,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	1,1,0,0,0,0,0,0,1,1		; N
	dc.b	1,1,1,0,0,0,0,0,1,1
	dc.b	1,1,1,1,0,0,0,0,1,1
	dc.b	1,1,1,1,1,0,0,0,1,1
	dc.b	1,1,0,1,1,1,0,0,1,1
	dc.b	1,1,0,0,1,1,1,0,1,1
	dc.b	1,1,0,0,0,1,1,1,1,1
	dc.b	1,1,0,0,0,0,1,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	0,0,1,1,1,1,1,1,0,0		; O
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0

	dc.b	1,1,1,1,1,1,1,1,0,0		; P
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,1,1,1,1,1,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0
	dc.b	1,1,0,0,0,0,0,0,0,0

	dc.b	0,0,1,1,1,1,1,1,0,0		; Q
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,1,1,1,0
	dc.b	1,1,1,0,0,0,1,1,1,0
	dc.b	0,1,1,1,1,1,1,1,1,1
	dc.b	0,0,1,1,1,1,0,0,1,1

	dc.b	1,1,1,1,1,1,1,1,0,0		; R
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,1,1,1,1,1,1,0
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	0,0,1,1,1,1,1,1,0,0		; S
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	1,1,1,0,0,0,0,0,1,1
	dc.b	1,1,1,0,0,0,0,0,0,0
	dc.b	0,1,1,1,1,1,1,1,0,0
	dc.b	0,0,1,1,1,1,1,1,1,0
	dc.b	0,0,0,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,1,1,1
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0

	dc.b	1,1,1,1,1,1,1,1,1,1		; T
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0

	dc.b	1,1,0,0,0,0,0,0,1,1		; U
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	0,1,1,1,1,1,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0

	dc.b	1,1,0,0,0,0,0,0,1,1		; V
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	0,1,1,0,0,0,0,1,1,0
	dc.b	0,1,1,0,0,0,0,1,1,0
	dc.b	0,0,1,1,0,0,1,1,0,0
	dc.b	0,0,1,1,0,0,1,1,0,0
	dc.b	0,0,0,1,1,1,1,0,0,0
	dc.b	0,0,0,1,1,1,1,0,0,0

	dc.b	1,1,0,0,0,0,0,0,1,1		; W
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1
	dc.b	1,1,0,0,1,1,0,0,1,1
	dc.b	1,1,0,1,1,1,1,0,1,1
	dc.b	1,1,1,1,0,0,1,1,1,1
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	1,1,0,0,0,0,0,0,1,1		; X
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	0,1,1,1,0,0,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0
	dc.b	0,0,0,1,1,1,1,0,0,0
	dc.b	0,0,0,1,1,1,1,0,0,0
	dc.b	0,0,1,1,1,1,1,1,0,0
	dc.b	0,1,1,1,0,0,1,1,1,0
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	1,1,0,0,0,0,0,0,1,1

	dc.b	1,1,0,0,0,0,0,0,1,1		; Y
	dc.b	1,1,1,0,0,0,0,1,1,1
	dc.b	0,1,1,1,0,0,1,1,1,0
	dc.b	0,0,1,1,1,1,1,1,0,0
	dc.b	0,0,0,1,1,1,1,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0
	dc.b	0,0,0,0,1,1,0,0,0,0

	dc.b	1,1,1,1,1,1,1,1,1,1		; Z
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	0,0,0,0,0,0,1,1,1,0
	dc.b	0,0,0,0,0,1,1,1,0,0
	dc.b	0,0,0,0,1,1,1,0,0,0
	dc.b	0,0,0,1,1,1,0,0,0,0
	dc.b	0,0,1,1,1,0,0,0,0,0
	dc.b	0,1,1,1,0,0,0,0,0,0
	dc.b	1,1,1,1,1,1,1,1,1,1
	dc.b	1,1,1,1,1,1,1,1,1,1

	section	bss
oldpal	ds.l	8
dot_dat	ds.l	740
buffer	ds.l	110*100/4
