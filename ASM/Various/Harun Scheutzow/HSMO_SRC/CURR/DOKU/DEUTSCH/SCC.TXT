SCC.PRG, ESCC.PRG, ST_ESCC.PRG
******************************

Dies sind Treiber fÅr die mit einem SCC oder ESCC (z.B. Z8530, Am85C30, 
Z85230) ausgestatteten seriellen Schnittstellen der Ataris und fÅr die 
Zusatzhardware ST_ESCC. Sie funktionieren zusammen mit DRVIN.PRG oder 
einem gleichwertigen Ersatz. EinfÅhrende Bemerkungen finden sich in 
1_README.TXT.


Allgemeines
-----------
Als "ESCC" betrachte _ich_ nur den Z85230 und den Am85C230A. Diese 
besitzen nebem dem auf 8 Byte vergrîûerten EmpfangsFIFO auch einen 
mindestens 4 Byte groûen SendeFIFO. Ein ESCC beinhaltet alle Funktionen 
eines SCC.

Die Konfigurationsmîglichkeiten der einzelnen *SCC*.PRG unterscheiden sich 
etwas.


Taktrate und Baudraten
----------------------
Ein SCC kann fÅr die Baudratenerzeugung verschiedene Taktquellen 
verwenden. Die meistbenutzte Taktquelle ist sein Systemtakt PCLK. Dieser 
Takt PCLK betrÑgt bei einem normalen (so wie von Atari geliefert) MegaSTE, 
TT und Falcon 8MHz (=8000000Hz). Das ist zwar eine schîne Zahl, die aber 
zur Erzeugung der hohen Standardbaudraten wenig geeignet ist. Die hohen 
Baudraten im MegaSTE/TT/Falcon werden aus anderen Taktquellen erzeugt. 
Meine Hardware ST_ESCC wird immer mit 14745600Hz getaktet.

Man kann einen MegaSTE, TT oder Falcon mit einem Quarzoszillator 
auf PCLK=14745600Hz umbauen (Vorschlag von Franz Sirl), was aber 
aus meiner Sicht keine Vorteile bringt. Die nachfolgende 
Aufstellung zeigt, welche Baudraten einstellbar sind. Meist 
mîchten TT-Besitzer auf MODEM2 zusÑtzlich die 57600, 115200 und 
230400 Bd haben, was bereits durch einen einfachen Umbau nur mit 
Draht realisierbar ist, der hier im Abschnitt "MODEM2 des TT mit 
57600, 115200 und 230400 Bd" beschrieben ist.

Die Treiber unterscheiden automatisch zwischen den beiden PCLK-Taktraten 
8MHz und 14745600Hz und zeigen die ermittelte Rate in ihrer 
Installationsmeldung an.

Bei einem PCLK von 8MHz sind folgende hohe Rsconf-Baudraten mîglich:
(neue - alte)
SERIAL2:
230400 - 200
115200 - 150
 57600 - 134
 38400 - 110
MODEM2:
 38400 - 110
153600 -  75
 76800 -  50
Bei MegaSTE und Falcon (beim TT erst nach Umbau mit Draht) sind zusÑtzlich 
auf MODEM2:
230400 - 200
115200 - 150
 57600 - 134

Bei PCLK = 14745600Hz sind bei MODEM2 und SERIAL2 mîglich:
neue Rate   alte Rate
 230400      200
 115200      150
  57600      134
  38400      110
 153600       75
  76800       50

Wenn man die GEMDOS-Fcntl TIOC?BAUD benutzt, hat man ohnehin kein Problem, 
dort erfÑhrt man, welche Baudraten mîglich sind im Klartext als 
"Bit pro Sekunde".

ST_ESCC enthÑlt immer einen ESCC. MegaSTE/TT/Falcon enthalten nur einen 
ESCC, wenn den jemand extra gewechselt hat. Der Treiber fÅr den SCC lÑuft 
auch mit dem ESCC-Schaltkreis, umgekehrt nicht.


SCC und ESCC
------------
Zur Erinnerung nochmal: Als "ESCC" betrachte _ich_ nur den Z85230 und den 
Am85C230A. Bei ST_ESCC wird immer ein ESCC eingesetzt. In 
MegaSTE/TT/Falcon befindet sich im Originalzustand nur ein SCC. Zur 
Entlastung der CPU und zur Verbesserung der Datensicherheit (geringere 
Wahrscheinlichkeit von Zeichenverlusten beim Empfang) kann man einen ESCC 
im PLCC-GehÑuse einsetzen. SCC und ESCC sind pinkompatibel genug.


SCC.PRG
-------
Der Treiber fÅr MODEM2 und SERIAL2/LAN des MegaSTE und TT sowie fÅr die 
einzige durch Atari herausgefÅhrte RS232-Schnittstelle des Falcon 
(beschriftet mit MODEM), wegen ihrer Verwandschaften hier ebenfalls MODEM2 
genannt.

Beim TT (und Falcon, falls man dem einen Beschleuniger mit FastRAM 
spendiert hat) darf SCC.PRG _keinesfalls_ ins FastRAM, da es sonst mit zu 
schnellen Zugriffen auf den SCC Probleme geben kann. Diese Probleme 
kînnten sich in Zeichenverlusten, unsinnigem Verhalten oder Bomben Ñuûern. 
Die Treiber mÅssen in physisch vorhandenes RAM geladen werden, dÅrfen also 
_nicht_ im virtuellen Speicher liegen.


ESCC.PRG
--------
Siehe SCC.PRG. Dieser Treiber ist nur fÅr die Nutzer, die sich einen 
Z85230 oder Am85C230A eingebaut haben. Der SCC-Treiber funktioniert 
ebenfalls mit dem ESCC, nutzt die ESCC-Vorteile aber nicht aus. Der 
ESCC-Treiber ist fÅr den SCC sehr ungeeignet!


ST_ESCC.PRG
-----------
Der Treiber nur fÅr (ich komm mir langsam wie in einer Dauerwerbesendung 
vor) die von mir entwickelte Hardware ST_ESCC, die zwei zusÑtzliche 
schnelle serielle Schnittstellen in ST/STE/MegaST realisiert. 115200Bd 
problemlos mit einem 8MHz/68000 unter TOS, das ist doch was.


Die Konfiguration
-----------------
Die Konfiguration erfolgt durch das SETTER.TTP. Zur Bedienung siehe 
SETTER.TXT.

USE4C
- - -
Diese Frage erscheint nur bei ESCC.PRG und ST_ESCC.PRG. Soll ein 
Empfangsinterrupt erst nach 4 empfangenen Zeichen erfolgen? Ich nenne 
diesen Modus, der erst nach 4 Zeichen einen Interrupt auslîst, 4ZI. 4ZI 
entlastet bei "RTS/CTS"- und "ohne"- Handshake die CPU wesentlich. Bei 
"XON/XOFF"-Handshake ist er automatisch ausgeschaltet, der Aufwand an 
Sonderbehandlungen hÑtte den Nutzen Åberstiegen. Neben den Vorteilen 
verkÅrzt 4ZI aber die freie LÑnge des EmpfangsFIFOs von 8 auf 4 Zeichen. 
Nach einer Interruptmeldung des ESCC an die CPU kînnen vor einer Reaktion 
der CPU nur noch 4 statt 8 Zeichen verlustfrei empfangen werden. 
Normalerweise schaltet man 4ZI an, antwortet also mit "Ja", da 4 freie 
Zeichen ausreichen und der Gewinn an CPU-Zeit durch die auf 1/4 
reduzierten Empfangsinterrupts wesentlich ist. Wenn man unsaubere 
Programme hat, muû man 4ZI wahrscheinlich immer ausschalten, also hier mit 
"Nein" antworten. Diese unsauberen Programme Ñuûern sich durch 
verschiedene Verzîgerungen: im Terminalmode kommen erst dann Zeichen auf 
den Bildschirm, wenn es 4 Zeichen sind. Unsaubere öbertragungsprotokolle 
hÑngen einige Zeit (oder ewig) fest, besonders am Anfang oder Ende.

M2TT
- - -
Die Standardeinstellung "u" sollte keine Probleme bereiten, da der TT 
anhand des _MCH-Cookies erkannt wird und dann auf MODEM2 keine 57600Bd und 
115200Bd mîglich sind. "0" legt fest, daû 57600/115200 bereitgestellt 
werden, was auf TTs aber nur sinnvoll ist, wenn man den Draht-Umbau 
gemacht hat. "1" legt fest, daû 57600/115200Bd nicht mîglich sind. Bei 
ST_ESCC.PRG wird diese Frage nicht gestellt. Wenn ein PCLK-Takt von 
14745600Hz erkannt wurde, ist die Antwort auf diese Frage bedeutungslos.

M1EMU
- - -
Die Standardeinstellung ist "u". Dies dÅrfte durch die automatischen 
Computertyperkennung anhand des _MCH-Cookies keine Probleme bereiten. 
Diese Funktion wurde extra auf Wunsch der Falcon-Besitzer und der Nutzer 
alter Programme eingebaut. Der reine Nutzer kann den Rest zu diesem 
Konfigurationspunkt Åberspringen.

Wenn man M1EMU einschaltet, sollte man normalerweise kein MFP*.PRG fÅr 
MODEM1 laden, da sich M1EMU damit beiût. Der am Computer eventuell 
vorhandene MODEM1-Anschluû wird bei eingeschaltetem M1EMU unbenutzbar. 
Falls doch z.B. auf dem Falcon das MFP_FALC.PRG geladen wird, um 
Teleoffice zur Funktion zu bewegen, so muû das MFP*.PRG _vor_ diesem 
*SCC.PRG geladen werden.

M1EMU, der MODEM1-Emulator, ersetzt die BIOS-Routinen des Kanals 6 
(MODEM1) durch die BIOS-Routinen von MODEM2. Auûerdem wird das aktuelle 
BIOS-GerÑt (AUX) auf 6 eingestellt, damit die BIOS-Routinen nicht nur in 
der MAPTAB auftauchen, sondern auch in den xco*-Vektoren.

"u" aktiviert M1EMU nur auf dem Falcon.
"0" verbietet M1EMU generell.
"1" schaltet M1EMU immer an.
"2" schaltet M1EMU immer an, aber MODEM1 wird jetzt durch SERIAL2 oder LAN 
ersetzt.

Beim Falcon
kann man so auch die Programme nutzen, die nur auf AUX (Kanal0) oder 
Kanal6 arbeiten wollen. Da die RING-Leitung (von MODEM2) ohnehin dort 
angeschlossen ist, wo beim ST die von MODEM1 lag, kînnen solche Programme 
auch RING direkt in der Hardware (MFP, Bit6) abfragen. Anstelle der 
DCD-Leitung (Carrier Detect) von MODEM1 (wie beim ST) liegt auf Bit1 des 
MFP leider der /ACK-Eingang vom Druckerport (Pin10), dÑmlicherweise ohne 
Widerstand, so daû er bei ausgeschaltetem oder nicht angeschlossenen 
Drucker wild schwingen kann. Bei eingeschaltetem Drucker dÅrfte er meist H 
sein, was diese alten Programme als "NO CARRIER" interpretieren. Abhilfe: 
Verbindung (von Pin10) zum Drucker auftrennen und Pin10 am Druckerport mit 
Pin25 verbinden, signalisiert diesen alten Programmen immer "CARRIER".

Bei MegaSTE/TT und ST_ESCC
kann man so auch alte Programme Åber MODEM2 laufen lassen, die die 
Statusleitungen RING und DCD direkt abfragen und sonst das BIOS benutzen. 
Sie dÅrfen nur nicht direkt auf das Empfangs/Senderegister zugreifen. Man 
muû dazu die Statusleitungen RING und DCD von MODEM2 mit denen von MODEM1 
verbinden. FÅr eine vollsteckbare Lîsung reichen drei SUB-D-Verbinder. 
RING ist Pin9 an einem 9poligen SUB-D und Pin22 an einem 25poligen SUB-D. 
DCD ist Pin1 an einem 9poligen SUB-D und Pin8 an einem 25poligen SUB-D.

LANBIT
- - - -
Hiermit wird mit "Ja" das Schalten des Soundchipportbits PA7 zur 
Umschaltung der Pegelwandler zwischen SERIAL2 und LAN erlaubt. Dies sollte 
man nur auf MegaSTE und TT erlauben, deshalb ist die Grundstellung "Nein", 
also keine Soundchipbeeinflussung. Auf MegaSTE und TT ist PA7 nach Reset 
normalerweise auf SERIAL2 gestellt.

LANEXT
- - - -
"Ja" erzeugt zwei EintrÑge, SERIAL2 und LAN, in der Maptab (BIOS-KanÑle), 
im RSVF-Cookie und im GEMDOS. Damit hat ein MegaSTE 4 Maptab-EintrÑge 
statt normalerweise 3 und der TT 5 statt 4. Das kînnte einige nicht so 
gute Programme doch verwirren. Deshalb ist die Standardeinstellung "Nein", 
bei der es nur einen Eintrag gibt, entweder SERIAL2 oder LAN. Vermutlich 
wird man ohnehin immer nur einen der beiden KanÑle benutzen, so daû "Nein" 
wohl die meistgebrauchte Einstellung sein dÅrfte.

LAN_S2
- - - -
Hier wird die Voreinstellung von Kanal A des ESCC festgelegt, also ob er 
fÅr LAN ("0") oder wie normalerweise der Fall fÅr SERIAL2 ("1") benutzt 
wird. Falls bei LANEXT festgelegt wurde, daû nur ein Eintrag existiert, so 
ist die hier gemachte Einstellung nicht nur die Voreinstellung, die direkt 
nach dem Laden der Treiber aktiv ist, sondern auch die endgÅltige 
Festlegung, ob ein SERIAL2- oder LAN-Treiber bereitgestellt wird. "u" ist 
die Standardeinstellung, bei der normalerweise SERIAL2, aber auf dem 
Falcon LAN, als Voreinstellung benutzt wird.

DTRM2
- - -
Das DTR(Data Terminal Ready)-Signal der Schnittstelle MODEM2 wird beim 
Start dieses Treibers einmalig auf den hier angegebenen Wert gesetzt. Eine 
Aktivierung mit "Ja" entspricht der Arbeitsweise des TOS, eine 
Deaktivierung mit "Nein" verhindert das "ungefragte" Abheben eines 
entsprechend konfigurierten Modems. Einige Programme, die von diesen 
Treibern nichts wissen und entsprechend Ataris Entwicklerdokumentationen 
(die katastrophal falsch sind) erstellt wurden, kommen mit "Nein" nicht 
klar (unmotiviertes Auflegen wÑhrend der DatenÅbertragung).

DTRS2
- - -
Wie DTRM2, aber fÅr Schnittstelle SERIAL2.

DRIM2
- - -
Diese Frage erscheint beim ST_ESCC.PRG nicht. Sie ist nur beim MegaSTE 
sinnvoll, der keinen RING-Eingang auf der MODEM2-Schnittstelle hat. Es ist 
aber ein (fast?) nie benutzter DSR-Eingang vorhanden. Die Einstellung "Ja" 
tut so, als ob der DSR-Eingang ein RING-Eingang wÑre und meldet den 
fragenden Programmen das Vorhandensein und den Zustand eines RING-Eingangs 
auf MODEM2. "Nein" ist die Åbliche Einstellung, die Schnittstelle hat also 
DSR, aber kein RING. Um "Ja" sinnvoll zu nutzen, muû man RING vom Modem 
auf DSR des Computers legen. Modifikation am 9poligen SUB-D-Stecker (des 
Modemkabels), den man (zum Betrieb, nicht zum Lîten) in die MODEM2-Buchse 
steckt: Draht von Pin6 (DSR) abtrennen und Drahtende isolieren. Draht von 
Pin9 (RING) ablîten und an Pin6 anlîten.

DRIS2
- - -
Diese Frage erscheint beim ST_ESCC.PRG nicht. Die SERIAL2-Schnittstelle 
bei MegaSTE und TT hat keinen RING-Eingang, aber einen (fast?) nie 
benutzten DSR-Eingang. Die Einstellung "Ja" tut so, als ob der DSR-Eingang 
ein RING-Eingang wÑre und meldet den fragenden Programmen das 
Vorhandensein und den Zustand eines RING-Eingangs auf SERIAL2. "Nein" ist 
die Åbliche Einstellung, die Schnittstelle hat also DSR, aber kein RING. 
Um "Ja" sinnvoll zu nutzen, muû man RING vom Modem auf DSR des Computers 
legen. Modifikation am 9poligen SUB-D-Stecker (des Modemkabels), den man 
(zum Betrieb, nicht zum Lîten) in die SERIAL2-Buchse steckt: Draht von 
Pin6 (DSR) abtrennen und Drahtende isolieren. Draht von Pin9 (RING) 
ablîten und an Pin6 anlîten.

HOGM2
- - -
Die Grundeinstellung ist "Ja". So kann die GEMDOS-Schnittstelle MODEM2 
mehrfach geîffnet werden, auch durch verschiedene Programme. Dies ist das 
von TOS her bekannte Verhalten, auf das sich einige Programme verlassen.

Mit "Nein" kann die GEMDOS-Schnittstelle ohne speziellen Wunsch der 
Programme nur genau einmal offen sein bzw. von einem Programm zur gleichen 
Zeit geîffnet werden. Dies ist bei MagiC ab Version 3 Åblich. Eine 
Programme oder Programmkombinationen kommen damit _nicht_ klar.

HOGS2
- - -
Siehe HOGM2, hier aber fÅr die GEMDOS-Schnittstellen SERIAL2 und LAN, je 
nachdem, was vorhanden ist. HOGS2 Ñndert aber nichts daran, daû SERIAL2 
und LAN nie gleichzeitig geîffnet sein kînnen.

RBLM2
- - -
Wenn man hiermit nichts anzufangen weiû, einfach 256 einstellen. Hier wird 
die EmpfangspufferlÑnge der MODEM2-Schnittstelle in Byte eingestellt. Sie 
darf maximal 65534 und minimal 16 betragen. Werte auûerhalb dieses 
Bereiches werden auf den Standardwert von 256 gesetzt. Die LÑnge wird auf 
eine gerade Zahl abgerundet. Die "Wassermarken", die die Steuerung des 
Handshakes mitbestimmen, werden generell auf 1/4 (low water mark) und 3/4 
(high water mark) gesetzt.

TBLM2
- - -
SendepufferlÑnge fÅr Schnittstelle MODEM2, zur ErlÑuterung siehe RBLM2.

RBLS2
- - -
EmpfangspufferlÑnge fÅr Schnittstelle SERIAL2, zur ErlÑuterung siehe 
RBLM2.

TBLS2
- - -
SenderpufferlÑnge fÅr Schnittstelle SERIAL2, zur ErlÑuterung siehe RBLM2.


MODEM2 des TT mit 57600, 115200 und 230400 bps
----------------------------------------------
Dieser Umbau erfordert etwas Lîterfahrung. Ein Takteingang wird 
durch den Umbau so beschaltet, wie er beim MegaSTE und Falcon 
beschaltet ist.

Der Leiterzug von pin17 des TT-MFP (MC68901) zu pin32 des SCC (Z85C30) 
wird aufgetrennt (oder pin17 des TT-MFP wird mit Plaststreifen gegen 
Fassung isoliert). Pin32 des SCC wird mit pin13 des SCC verbunden. Bei der 
entsprechenden Frage (M2TT) in der Konfiguration des ?SCC.PRG muû man dann 
vorgeben, einen MegaSTE/Falcon zu benutzen.


MegaSTE mit MODEM2/SERIAL2-Fehlern
----------------------------------
Es gibt einige MegaSTE, die bei der DatenÅbertragung Åber MODEM2 oder 
SERIAL2 und gleichzeitigen DMA-Zugriffen auf Festplatte oder Diskette 
Dateien zerstîren. Meist Ñuûert sich dies darin, daû z.B. per Zmodem 
empfangene oder gesendete Archive (z.B. LZH, ZOO, ZIP) sich nicht mehr 
auspacken lassen, weil der Packers eine Fehlermeldung liefert. Eine 
andere Erscheinungsform sind wohl vermehrte Empfangsfehler, die noch 
durch z.B. Zmodem korrigiert werden kînnen. Dieser Fehler wird durch ein 
fehlerhaftes PAL in der Steuerlogik fÅr den SCC verursacht. Franz Sirl hat 
ein GAL entwickelt, das das PAL ersetzt und die Fehler erfahrungsgemÑû 
beseitigt. Das Listing fÅr das GAL ist in Mailboxen im Archiv FSER096B.LZH 
zu finden.


LAN-UnterstÅtzung
-----------------
Das hat jetzt wieder eine ganze Menge Arbeit gemacht und ist noch nicht so 
ganz wie ich es mir vorstelle. WÑre nett, wenn die (potentiellen) Anwender 
sich dazu mal Ñuûern.

Die LAN-Schnittstelle und die SERIAL2-Schnittstelle benutzen den gleichen 
Kanal im SCC, Kanal A. Dieser Kanal A wird nur jeweils mit einem anderen 
Pegelwandler verbunden. SERIAL2 und LAN kînnen also _nicht_ gleichzeitig 
betrieben werden. Im MegaSTE und TT erfolgt die Umschaltung zwischen den 
Pegelwandlern Åber das Soundchip-Portbit PA7 und die Ausgangsleitungen des 
nicht aktiven Pegelwandlers werden auf einen inaktiven Pegel gelegt (??). 
Im Falcon gibt es keine Umschaltung, da nur der LAN-Pegelwandler vorhanden 
ist. Beim 1*RS232+1*LAN-Pegelwandler zum ST_ESCC gibt es ebenfalls keine 
Umschaltung. Die Mega-ST_ESCC-Version bietet bei entsprechender BestÅckung 
die Umschaltmîglichkeit mit einem mechanischen DIP-Schalter, der aber auch 
durch eine Leitung zum Soundchip, wie beim TT, ersetzt werden kann. 
Mega-ST_ESCC schaltet jedoch im Gegensatz zum TT die Ausgangsleitungen der 
nicht aktiven Schnittstelle nicht inaktiv.

Dieses PA7-Bit wird in STs und manchmal auch im MegaSTE und TT durch 
eine DrahtbrÅcke auf den Druckerport gefÅhrt zur Ansteuerung von Scannern. 
Davon sollte der Besitzer des Rechners aber wissen und sich entsprechend 
verhalten.

Ich bin der Meinung, daû man normalerweise nur entweder LAN (ein Mix aus 
RS422 und RS423) oder SERIAL2 (RS232) benutzt. Der Treiber ist aber 
flexibel genug, auch die abwechselnde Nutzung beider Schnittstellen zu 
erlauben, ohne neu zu booten. Die Umschaltung erfolgt dabei ausschlieûlich 
durch die GEMDOS-Funktion Fopen auf U:\DEV\LAN oder U:\DEV\SERIAL2 und 
bleibt auch nach Fclose bestehen. Die BIOS/XBIOS-Funktionen schalten nicht 
um sondern nutzen die durch das GEMDOS gemachte Einstellung.

Die LAN-Schnittstelle hat keine RTS-Leitung, so daû dort normalerweise 
kein RTS&CTS-Hardwarehandshake (Hwhs) mîglich wÑre. Auf dem Mac ist als 
bidirektionaler Hwhs der DTR&CTS-Handshake Åblich. Anstelle der 
RTS-Leitung wird die DTR-Leitung benutzt. Dies habe ich hier 
implementiert, Hwhs auf der LAN-Schnittstelle bedeutet also DTR&CTS 
anstelle von RTS&CTS.

RTS wird intern benutzt, um den Sender hochohmig zu schalten. Im 
SERSOFST.TXT ist eine entsprechende Mîglichkeit vorgesehen, mîglicherweise 
baue ich das auch mal ein (Åber I/O-Lines). ##########

Momentan ist immer bei Umschaltung auf LAN kein DTR verfÅgbar in den 
I/O-Lines, das wird sich eventuell noch Ñndern, so daû nur bei 
eingeschaltetem Hwhs kein DTR verfÅgbar ist. ###############

Es gibt noch einen wesentlichen Unterschied zwischen den seriellen 
Schnittstellen der Macintosh-Computer und dem dazu einigermaûen 
kompatiblen Atari-LAN: Beim Atari sind RXD+ und RXD- Åber einen 
100-Ohm-Widerstand (Abschluû, Terminator) verbunden und der GPi-Eingang 
liegt Åber 100 Ohm an GND. Beim Mac sind diese WiderstÑnde nicht vorhanden 
und werden nur an den Enden eines LocalTalk-Netzwerkes Åber die kleinen 
KÑsten realisiert. Es sieht also so aus, als sollte man nur 2 Ataris 
koppeln, anstelle der fast beliebig viele Mac, die man per LocalTalk 
aneinanderhÑngen kann.

Anschluûbelegung der 8poligen Mini-DIN-Buchse:
  --***--
/ 8  7  6 \
|5    4  3|
\  2   1  /
  -------
Pin Name  Beschreibung
 1  HSKo  Output Handshake, DTR-Signal vom SCC
 2  HSKi  Input Handshake or External Clock, CTS-Signal zum SCC
 3  TXD-  Transmit Data -, Sendedaten negiert
 4  GND   Signal Ground
 5  RXD-  Receive Data -, Empfangsdaten negiert
 6  TxD+  Transmit Data +, Sendedaten nicht negiert
 7  GPi   General Purpose Input, DCD-Signal zum SCC
 8  RxD+  Receive Data +, Empfangsdaten nicht negiert

Wenn man die LAN(RS422/423)-Schnittstelle mit einer RS232 verbinden will, 
als Nullmodem mit Benutzung von Hwhs, sollte man verbinden:
LAN            RS232
HSKo           CTS
HSKi           RTS
TXD-           RXD
TXD+   offen
RXD-           TXD
RXD+   GND
GND            GND

Interessanterweise negieren alle Pegelwandler, nur der fÅr HSHi/CTS nicht. 
Dies wurde natÅrlich im Treiber berÅcksichtigt.


Empfangsprobleme auf der LAN-Schnittstelle
------------------------------------------
Die im vorigen Abschnitt erwÑhnten beiden 100-Ohm-WiderstÑnde sorgen bei 
einigen Nutzern fÅr Empfangsprobleme, wenn die LAN-Schnittstelle mit als 
RS232-Schnittstelle zum Anschluû von Modems genutzt wird. Teilweise treten 
diese Fehler nur bei Zmodem-öbertragungen, allerdings unabhÑngig von der 
eingestellten Datenrate, auf.

Wie schon erwÑhnt, besitzt das Vorbild, der Mac, diese WiderstÑnde 
nicht. Die Problembeseitigung besteht im Auslîten der beiden WiderstÑnde.

Die beiden 100-Ohm-WiderstÑnde findet man, indem man auf der 
Computerplatine ausgehend von der LAN-Buchse die Leitungen RXD+, RXD- und 
GPi verfolgt. Zuerst sollte man einen 22- oder 27-Ohm-Widerstand in der 
Leitung antreffen, dann einen Kondensator mit etwa 220 pF von der Leitung 
gegen Masse (GND). Es folgt ein 22- oder 27-Ohm-Widerstand in der Leitung. 
Nun sind RXD+ und RXD- durch den auszulîtenden 100-Ohm-Widerstand 
verbunden. Entsprechend ist GPi Åber den anderen auszulîtenden 
100-Ohm-Widerstand mit Masse (GND) verbunden.


FÅr Programmierer: Der IOREC
----------------------------
Finger weg von der Bestimmung der lesbaren Byteanzahl Åber den IOREC! Das 
geht bei eingeschaltetem 4-Zeichen-Interrupt des ESCC und ST_ESCC voll 
daneben, da eben bis zu 3 Zeichen im ESCC herumhÑngen und nicht 
automatisch in den Empfangspuffer wandern. Immerhin bringt dieser 
Interruptmodus eine wesentliche Systementlastung. Stattdessen FIONREAD 
oder gleich Fread benutzen, funktionieren bei diesen Treibern beide 
richtig. Bconstat funktioniert ebenfalls.


FÅr Programmierer: Behandlung von Empfangsfehlern
-------------------------------------------------
Der ESCC macht eine Fehlerbehandlung recht schwer, bzw langwierig, was die 
Datenrate senken wÅrde, wenn man seinen EmpfangsFIFO sinnvoll nutzt. 
Deshalb ist die Empfangsfehlerabfrage mit TIOCCTLGET noch _nicht_ 
implementiert. Fehlerhaft empfangene Zeichen, auûer receiver overrun, also 
parity error und frame error, werden der Einfachheit halber mit in den 
Empfangspuffer Åbernommen. Im Gegensatz dazu beseitigt der MFP-Treiber 
alle Zeichen mit Empfangsfehlern.


Versionen
---------
Wenn nicht extra vermerkt, gelten die Daten fÅr alle *SCC*.PRG.
1993-11-25
jetzt auch 115200/57600 auf MODEM2 bei MegaSTE/Falcon
ST_ESCC hat nichts sinnvolles zum Konfigurieren, entsprechend dÑmlich die 
Meldung
1993-12-01
TIOCM_RNG auf MODEM2 bei TT/Falcon/ST_ESCC, TIOCM_RNG auf SERIAL2 fÅr 
ST_ESCC, kleine Verzîgerung fÅr Siegfried Hartmanns TT an einer Stelle 
eingebaut
1993-12-27
Fcntl TIONOTSEND implementiert, bei ESCC und ST_ESCC ist 
4-Zeichen-Interrupt abschaltbar
1994-01-01
TIOCM_DSR in den TIOCCTL* vorhanden, Fcntl TIOCFLUSH implementiert, 
DTR-Signal durch Nutzer voreinstellbar, Puffergrîûen durch Nutzer 
einstellbar
1994-03-27
Fcntl TIOCFLUSH Nr.1,2,3 gehen jetzt endlich
1994-04-07
Empfangspuffer High-Water-Mark richtig initialisiert
1994-06-12
M1EMU (MODEM1-Emulation durch MODEM2) ist mîglich, alle ?TB?? 
Konfigurationen in einer Tabelle
1994-06-17  ACHTUNG! Installationsblock an MagiC3 angepaût. Nur noch 
Treiber und DRVIN von 1994-06-17 oder jÅnger zusammen verwenden. Versionen 
vor dem 1994-06-17 laufen nicht mit denen ab 1994-06-17 zusammen.
1994-07-11  Konfigurationspunkt LANBIT neu
1994-08-20  M2TT mit Autodetect ausgestattet, 1994-08-13  LANBIT, LANEXT, 
LAN_S2 neu/geÑndert, Byte4.Bit0 im RSVF
1994-08-27  Konfigurationspunkt PCLK ersetzt durch automatische Ermittlung
1994-10-09  DTR mit TIOCCTLGET rÅcklesbar (RTS auch, aber noch versteckt), 
CTS lesbar
1994-10-29  TIOCFLUSH korrigiert, etwas rumgebastelt, 230400Bd
1994-12-25  Konfigurationspunkt M2DRI, etwas rumgebastelt, u.a. fÅr 68040 
mit WriteBack-Cache-Einstellung
1995-01-04  schnelle Bconout-ParameterÅbergabe geÑndert 
(und MAPT_APP/MAPT_OVE Funktiosnummer), ...
1995-01-15  XON/XOFF-Empfangsfehler bei Empfangs != SendepufferlÑnge raus
1995-02-20  kein Buserror mehr, wenn in einer sehr kurzen Zeitspanne beim 
Booten zufÑllig auf SERIAL2 Zeichen empfangen werden
1996-01-31  Konfigurationspunkt S2DRI
1996-06-08  Konfig M1EMU: neuer Parameterwert 2, immer AUX=#6 statt 7
1996-12-31  Installationsroutine geÑndert, Leitungen DSR und RI tauchen 
bei LAN-Schnittstelle nicht mehr auf
1997-03-02  Umstellung auf GEN-Assembler, Konfig HOGM2 und HOGS2 
eingebaut, Konfigs M2DRI und S2DRI in DRIM2 und DRIS2 unbenannt, extrem 
unwahrscheinlich beiûender Fehler aus Empfangsinterruptroutine (wenn 
PufferÅberlauf und wrap-around gleichzeitig, dann wurde Schreibzeiger auf 
beliebigen MÅll gesetzt) raus
1997-05-17  Alignment der InterruptroutinenanfÑnge auf durch 4 teilbare 
Adressen, wirkt nur, wenn das OS (wie MagiC) Programme auf 4er lÑdt

Harun Scheutzow
