*********************************************************
*							*
* NOM : CREATION DE SPRITES 				*
*							*		 
* CODE: ST-MAG & THE SHADOW / ATM (THE HORDE)		*
* DATE: 25/03/1991					*
* ASSEMBLEUR: DEVPACK V. 2.20				*
* 							*
* DESCRIPTION RAPIDE:					*
* ------------------					*
*							*
* - PARAMETRABLES (CHOIX DES PLANS ETC...)		*
*							*
*********************************************************

	***** PARAMETRE POUR LE FGET *****

ABSCISSE =	0	* (0,15,...,159,...319)
ORDONNEE =	0	* ENTRE 0 ET 199
LARGEUR	 =	8	* LARGEUR ENTRE 1 ET 20 CAR ELLE EST 
			* MULTIPLIEE PAR 16
HAUTEUR	 =	50   	* NB DE LIGNES (ENTRE 1 ET 200)
PLAN	 =	%1111	* AU CHOIX (%1001 OU %1111 OU %0011 ETC...)

	***** PARAMETRE POUR LE FPUT *****
	
X	=	20	* POSITION AXE DES X
Y	=	40	* POSITION AXE DES Y

	CLR	-(SP)
	MOVE	#$20,-(SP)
	TRAP	#1
	ADDQ.L	#6,SP

	MOVE.W	#0,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.L	#-1,-(SP)
	MOVE.W	#5,-(SP)
	TRAP	#14
	ADD.L	#12,SP

	MOVE.L	#SPRITE+2,-(SP)
	MOVE.W	#6,-(SP)
	TRAP	#14
	ADDQ.L	#6,SP

	DC.W	$A00A
	MOVE.B	#$12,$FFFFFC02
		
	BSR	FGET
	BSR	FPUT
	
SPACE	CMPI.B	#$39,$FFFC02
	BNE	SPACE

	MOVE.B	#$8,$FFFFFC02		
	
	CLR	-(SP)
	TRAP	#1

	***** CALCULER SPRITE *****		

FGET	LEA.L	SPRITE+34,A0	* SOURCE DU SPRITE
	MOVE.L	#ABSCISSE,D0 	* ABSCISSE DU SPRITE
	MOVE.L	#ORDONNEE,D1	* ORDONNEE SU SPRITE
	MOVE.L	#LARGEUR,D2	* LARGEUR X 16
	MOVE.L	#HAUTEUR,D3	* HAUTEUR EN NB DE LIGNES
	LEA.L	STOCK,A2		* ADRESSE DE STOCKAGE
	MOVE.L	#PLAN,D4		* PLANS SELECTIONNES
	LEA	(A2),A4
	LEA	$1E(A2),A2
	MOVE.L	D4,(A4)+
	LSR.L	#4,D0
	LSL.L	#3,D0
	MULU	#$A0,D1
	ADD.L	D0,D1
	ADDA.L	D1,A0
	MOVE.W	D2,D7
	LSL.L	#3,D7
	MOVE.L	D7,D6
	NEG.L	D7
	ADDI.L	#$A0,D7
	SUBQ.L	#8,D7
	MOVE.L	D7,(A4)+
	ADDQ.L	#8,D7
	SUBQ.L	#1,D2
	SUBQ.L	#1,D3
	MOVE.L	D2,(A4)+
	MOVE.L	D3,(A4)+
	MOVEQ	#-1,D0
	MOVEQ	#3,D6
NB_BIT1	BTST	D6,D4
	BEQ	BIT_SU
	ADDQ.L	#1,D0
	MOVE.L	D6,D1
	LSL.L	#1,D1
	NEG.L	D1
	ADDQ.L	#6,D1
	MOVE.W	D1,(A4)+
BIT_SU	DBF	D6,NB_BIT1
	MOVE.L	D0,D6
	ADDQ.L	#1,D6
	LSL.L	#1,D6
	SUBA.L	D6,A4
	ADDA.L	#8,A4
	MOVE.L	D0,(A4)

	MOVE.W	D3,D1
HAUTR	MOVE.L	D2,D0
LARG	MOVEQ	#3,D6
BIT1	BTST	D6,D4
	BEQ	SUIV1
	MOVE.W	(A0),(A2)+
SUIV1	LEA	2(A0),A0
	DBF	D6,BIT1

	DBF	D0,LARG
	ADDA.L	D7,A0
	DBF	D1,HAUTR
	
	RTS

	***** AFFICHER SPRITE *****

FPUT	MOVE.L	#X,D0		* ABSCISSE D'AFFICHAGE
	MOVE.L	#Y,D1		* ORDONNEE D'AFFICHAGE
	LEA.L	STOCK,A0		* SOURCE SPRITE
	MOVE.L	$44E.W,A4		* ECRAN DESTINATION
	CMPI.W	#$140,D0
	BCS	L75DB4
	RTS
L75DB4	TST.W	D0
	BGE	L75DBC
	RTS
L75DBC	CMPI.W	#$C8,D1
	BCS	L75DC6
	RTS
L75DC6	TST.W	D1
	BGE	L75DCE
	RTS
L75DCE	LEA	$1E(A0),A2
	MOVE.L	4(A0),LIGNE
	MOVE.L	8(A0),LARGE
	MOVE.L	#0,BORD
	MOVE.L	D0,D6
	ANDI.L	#$F,D6
	NEG.L	D6
	ADDI.L	#$10,D6
	MOVE.B	#0,OUT_S
	LSR.L	#4,D0
	MOVE.L	D0,D4
	MOVE.L	D0,D5
	ADD.L	8(A0),D5
	CMPI.B	#$13,D5
	BCS	L75E4A
	NEG.L	D4
	ADDI.L	#$13,D4
	MOVE.L	D4,LARGE
	NEG.L	D4
	ADD.L	8(A0),D4
	MOVE.L	$18(A0),D5
	ADDQ.L	#1,D5
	LSL.L	#1,D5
	MULU	D4,D5
	MOVE.L	D5,BORD
	LSL.L	#3,D4
	ADD.L	D4,LIGNE
	MOVE.B	#1,OUT_S
L75E4A	LSL.L	#3,D0
	MOVE.L	$C(A0),D7
	MOVE.L	D1,D4
	MOVE.L	D1,D5
	ADD.L	$C(A0),D5
	CMPI.W	#$C8,D5
	BCS	L75E6A
	NEG.L	D4
	ADDI.L	#$C8,D4
	MOVE.L	D4,D7
L75E6A	MULU	#$A0,D1
	ADD.L	D0,D1
	ADDA.L	D1,A4
	MOVE.L	$18(A0),D4
	CMPI.B	#2,D4
	BEQ	L75F38
	CMPI.B	#1,D4
	BEQ	L76008
	TST.B	D4
	BEQ	L760B0
L75E8C	MOVE.L	D7,HAUT1
	MOVE.L	LARGE,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	MOVEQ	#0,D4
L75EA0	CLR.W	D1
	CLR.W	D2
	CLR.W	D3
	CLR.W	D4
	MOVEQ	#0,D5
	CLR.W	D7
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D1
	SWAP	D1
	MOVEQ	#0,D5
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D2
	SWAP	D2
	MOVEQ	#0,D5
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D3
	SWAP	D3
	MOVEQ	#0,D5
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D4
	SWAP	D4
	MOVEQ	#0,D5
	SWAP	D7
	NOT.W	D7
	AND.W	D7,(A4)
	OR.W	D1,(A4)+
	AND.W	D7,(A4)
	OR.W	D2,(A4)+
	AND.W	D7,(A4)
	OR.W	D3,(A4)+
	AND.W	D7,(A4)
	OR.W	D4,(A4)+
	DBF	D0,L75EA0
	ADDA.L	BORD,A2
	TST.B	OUT_S
	BNE	L75F24
	SWAP	D7
	SWAP	D1
	SWAP	D2
	SWAP	D3
	SWAP	D4
	NOT.W	D7
	AND.W	D7,(A4)
	OR.W	D1,(A4)+
	AND.W	D7,(A4)
	OR.W	D2,(A4)+
	AND.W	D7,(A4)
	OR.W	D3,(A4)+
	AND.W	D7,(A4)
	OR.W	D4,(A4)+
	LEA	-8(A4),A4
L75F24	ADDQ.L	#8,A4
	ADDA.L	LIGNE,A4
	MOVE.L	HAUT1,D7
	DBF	D7,L75E8C
	RTS
L75F38	LEA	(A4),A1
	LEA	(A4),A5
	LEA	(A4),A6
	MOVEQ	#0,D4
	MOVE.W	$10(A0),D4
	ADDA.L	D4,A4
	MOVE.W	$12(A0),D4
	ADDA.L	D4,A5
	MOVE.W	$14(A0),D4
	ADDA.L	D4,A6
L75F52	MOVE.L	D7,HAUT1
	MOVE.L	LARGE,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
L75F64	CLR.W	D1
	CLR.W	D2
	CLR.W	D3
	MOVEQ	#0,D5
	CLR.W	D7
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D1
	SWAP	D1
	MOVEQ	#0,D5
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D2
	SWAP	D2
	MOVEQ	#0,D5
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D3
	SWAP	D3
	MOVEQ	#0,D5
	SWAP	D7
	NOT.W	D7
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	OR.W	D1,(A4)
	OR.W	D2,(A5)
	OR.W	D3,(A6)
	ADDQ.L	#8,A4
	ADDQ.L	#8,A5
	ADDQ.L	#8,A6
	DBF	D0,L75F64
	ADDA.L	BORD,A2
	TST.B	OUT_S
	BNE	L75FDC
	SWAP	D7
	SWAP	D1
	SWAP	D2
	SWAP	D3
	NOT.W	D7
	AND.W	D7,(A1)
	AND.W	D7,2(A1)
	AND.W	D7,4(A1)
	AND.W	D7,6(A1)
	OR.W	D1,(A4)
	OR.W	D2,(A5)
	OR.W	D3,(A6)
L75FDC	ADDQ.L	#8,A1
	ADDQ.L	#8,A4
	ADDQ.L	#8,A5
	ADDQ.L	#8,A6
	ADDA.L	LIGNE,A1
	ADDA.L	LIGNE,A4
	ADDA.L	LIGNE,A5
	ADDA.L	LIGNE,A6
	MOVE.L	HAUT1,D7
	DBF	D7,L75F52
	RTS
L76008	LEA	(A4),A1
	LEA	(A4),A5
	MOVEQ	#0,D4
	MOVE.W	$10(A0),D4
	ADDA.L	D4,A4
	MOVE.W	$12(A0),D4
	ADDA.L	D4,A5
L7601A	MOVE.L	D7,HAUT1
	MOVE.L	LARGE,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
L7602A	CLR.W	D1
	CLR.W	D2
	MOVEQ	#0,D5
	CLR.W	D7
	MOVE.W	(A2)+,D5

	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D1
	SWAP	D1
	MOVEQ	#0,D5

	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D2
	SWAP	D2
	MOVEQ	#0,D5

	SWAP	D7
	NOT.W	D7
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	OR.W	D1,(A4)
	OR.W	D2,(A5)
	ADDQ.L	#8,A4
	ADDQ.L	#8,A5
	DBF	D0,L7602A
	ADDA.L	BORD,A2
	TST.B	OUT_S
	BNE	L7608C
	SWAP	D7
	SWAP	D1
	SWAP	D2
	NOT.W	D7
	AND.W	D7,(A1)
	AND.W	D7,2(A1)
	AND.W	D7,4(A1)
	AND.W	D7,6(A1)
	OR.W	D1,(A4)
	OR.W	D2,(A5)
L7608C	ADDQ.L	#8,A4
	ADDQ.L	#8,A5
	ADDQ.L	#8,A1
	ADDA.L	LIGNE,A1
	ADDA.L	LIGNE,A4
	ADDA.L	LIGNE,A5
	MOVE.L	HAUT1,D7
	DBF	D7,L7601A
	RTS
L760B0	LEA	(A4),A1
	MOVEQ	#0,D4
	MOVE.W	$10(A0),D4
	ADDA.L	D4,A4
L760BA	MOVE.L	D7,HAUT1
	MOVE.L	LARGE,D0
	MOVEQ	#0,D1
L760C8	CLR.W	D1
	MOVEQ	#0,D5
	CLR.W	D7
	MOVE.W	(A2)+,D5
	LSL.L	D6,D5
	OR.L	D5,D7
	OR.L	D5,D1
	SWAP	D1
	MOVEQ	#0,D5
	SWAP	D7
	NOT.W	D7
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	AND.W	D7,(A1)+
	OR.W	D1,(A4)
	ADDQ.L	#8,A4
	DBF	D0,L760C8
	ADDA.L	BORD,A2
	TST.B	OUT_S
	BNE	L76114
	SWAP	D7
	SWAP	D1
	NOT.W	D7
	AND.W	D7,(A1)
	AND.W	D7,2(A1)
	AND.W	D7,4(A1)
	AND.W	D7,6(A1)
	OR.W	D1,(A4)
L76114	ADDQ.L	#8,A4
	ADDQ.L	#8,A1
	ADDA.L	LIGNE,A4
	ADDA.L	LIGNE,A1
	MOVE.L	HAUT1,D7
	DBF	D7,L760BA

	RTS

*******

	SECTION	BSS
	
STOCK	DS.B	32000

*******	

	SECTION	DATA

	EVEN	
SPRITE	INCBIN	'INCBIN.DIV\16X16.PI1'	
	EVEN	
HAUT1	DC.L	0
LIGNE	DC.L	0
BORD	DC.L	0
LARGE	DC.L	0
OUT_S	DC.B	0	