--------------
MADMAC history
--------------


lost-history
	Wrote it and fixed lots of bugs.

5-Nov-1986 0.09 lmd
	Added general purpose deposit function, so
		ds.x works in 6502 mode
		ds.x works in -6 mode (for AS68 kludge mode)
		added ".init" directive

10-Nov-1986 0.09 lmd
	Include-file filenumber (cfileno) computed and restored
		improperly; error messages in include files always
		referred to the first file included.

11-Nov-1986 0.10 lmd
	Fixed several problems with 6502 code generation.  Added
		Atari Coin-Op addressing modes.
	Added ".cargs" directive.  Really useful!

16-Nov-1986 0.10a lmd
	Added REG equative, to hack register lists
	Added immediate (#) special modes to MOVEM to specify
		explicit register masks.

18-Nov-1986 0.10b lmd
	Random twiddling.

19-Nov-1986 0.10c lmd
	Fixed bug in .PRG mode, sign extension problem in markimg().
		(I thought << 24 would default to long, the compiler
		thought otherwise).

20-Nov-1986 0.10c lmd
	Added '-yN' flag to commandline; specifies page height for listings.
	.title clears subtitle.  Also page-ejects if not on page 1.
	Added register-list handling in ".cargs" (may rip it out later).

	Added '-z' flag to conv65 (for downloading to ROM burners) and
		wrote man page for conv65.

20-Nov-1986 0.10d lmd
	Non-global non-referenced equated symbols are not written to
		the object file.  Drastically reduces the size of files
		including ATARI.S (for instance).

23-Nov-1986 0.10e lmd
	Numeric macro argument references are now \1 through \9, for the
		first through ninth arguments, with \0 meaning the tenth.
	Check for "-y" of less than 10 (and complain).

 3-Dec-1986 0.10f lmd
	Removed 68010 instruction "MOVE CCR,<ea>" from "68ktab".
	Changed "-l" and "-e" flags to default to first input filename.
	Made "-d" acceptable on UNIX.
	Made "MACPATH" env variable work on ST.  (Added _getenv() to stasm.s).

 4-Dec-1986 0.11 lmd
	Added "-" leadin to .subttl to suppress auto-eject.
	Removed some unused switches.
	Removed some "Internal Atari Use" only messages.
	Re-wrote and fixed part of the documentation.
	The Alpha Release is version 0.11 --- hooray!  (Will anybody
		but me use it for the 68000?)
	Someday that debug code is gonna have to come out....

 9-Dec-1986 0.11 lmd
	Global symbols involved in complex expressions did not
		have their REFERENCED bits set, and did not end up
		in the output symbol table.
	(Same version number --- yuck!)

12-Dec-1986 0.11a lmd
	Made [] work as parenthesis.  Need to document this.

31-Jan-1987 0.11b lmd
	Fixed bug in "-yN" flag that prevented it from working.
	Fixed bug that caused infinite loop on sub-titles longer
		than 40 characters.  Also, allow subtitles and
		titles of any length.

 2-Feb-1987 0.11b lmd
	Made symbols that ".cargs" defines EQUATED, for stupid LINK68 linker.

11-Feb-1987 0.11c lmd
	Optimize absolute addresses to short form (ABSW) when possible.

16-Feb-1987 0.11d lmd
	"object.c"   o	COMMON symbols are emitted as AL_EXTERN, and
			 do not include the AL_GLOBAL bit.
		     o	Header is written contiguous with text+data
			 write() call, to speed up the GEMDOS version.

	Added "-pN" switch to limit symbol output on .PRG files:
		-p or -p1 emits NO symbols;
		-p2 emits all symbols.

23-Feb-1987 0.11e lmd
	Symbols are written to the object file in order of
		their declaration in the source file.

24-Feb-1987 0.11e lmd
	Print error message when forward reference is made with "bra.s"
		to the very next location ("illegal short branch").

27-Feb-1987 0.11g lmd
	Fixed bug that caused forward-referenced PC-relative expressions
		to allow out-of-segment values.  No complains if exprs
		are not absolute or in the same segment.
	Complains about unknown switches.

 1-Mar-1987 0.11h lmd
	Fixed bug that caused \r\n broken between two file reads to be
		treated as two input lines (source of "line mismatch"
		bug in error message reporting).

 3-Mar-1987 0.11j lmd
	COMMON symbols needed AL_EXTERN|AL_GLOBAL, not just AL_EXTERN.

 9-Mar-1987 0.11k lmd
	Fixed problem with 'macuniq' and nested macros, so "\~" now
		works correctly when macros are nested.

10-Mar-1987 (none) lmd
	Added PRTERR0 and PRTERR1 macros for printing error messages
		(gets rid of #ifdef ST/BSD garbage).

31-Mar-1987 (none) lmd
	Added "-i" switch:
		-i<symbol>		equates "symbol" to 0
		-i<symbol>=<const>	equates "symbol" to the
					    specified decimal constant

	Added "-f" switch for object file format:

		-fa	Alcyon
		-fm	MWC

1-Apr-1987 0.11m lmd
	Added "-fm" for MWC object code format.
	Fixed what appeared to be a bug in markimg(), if(symbol) was
		not checking for 'okflag', and was depositing symbol
		relocation information (at the wrong time) into the
		text+data buffer.

	sect.c	Fixed bogus short-branch problem (0x180 ==> 0x100)
		Fixed problem with short branches being reported on
			external symbols (wups).
		MWC expects "*" to be subracted from external values
			that are PC-relative.

2-Apr-1987 0.11m lmd
	Flipped "-i" and "-d" switch.
	-p switches are now:

		-p	.PRG with no symbols
		-ps	.PRG with symbols

14-Apr-1987 0.11p lmd
	The MWC object segments are considered contiguous, and all values
		(including symbols) must reflect that.  Made symbol values
		correct.

17-Apr-1987 0.11s lmd
	MWC fixup records must be sorted according to address; we now include
		a qsort() of fixups.  What a kludge.
	Took out obnoxious warning message about as68 kludge mode.

 1-May-1987 0.11t lmd
	"-fmu" switch (extension to "-fm") will move a single underscore
		at the beginning of a symbol to the end of the symbol in
		the MWC object file.

20-May-1987 0.11v lmd
	Macro stack is now infinite.
	If a size is specified immediately following a macro invocation,
		then it becomes part of the first argument.  (This will
		change to a special backslash code soon).

29-May-1987 0.11w lmd
	Fixed problem with optimization of MOVE to MOVEQ; non-absolute
		values were (incorrectly) being optimized.  Now only
		absolute, defined values are optimized.

 5-Jun-1987 0.11x lmd
	Fixed problem with section-checking code for equality/inequality
		booleans.  They now accept any two values as long as they
		are in the same section.

11-Jun-1987 0.11y lmd
	"-o" has two forms:  "-oNAME" and "-o NAME"  so that it is
		consistent with the other switches.

14-Jun-1987 lmd
	Moved check for 'at_eol()' in d_include() so that the most common
		error, an include directive something like:

			.include equates.s

		is caught and handled correctly.

21-Jun-1987 0.11z lmd
	Added "\!" to macro expander; expands to size specified on the
		macro invocation line.


23-Jun-1987 0.11z lmd
	Added "$" pseudo-variable to expression analyzer; is the current
		location counter (not at the beginning of the line).

 9-Jul-1987 0.12 lmd
	Fixed problem with "movem #.foo,-(sp)" immediated-form; abs_expr()
		was declared as returning a value in m_movem(), while it
		really returns an int.

13-Jul-1987 0.12a lmd
	Fixed bug in sect.c that wasn't catching PC-indexed forward
		references that were out of the range -127..128.

14-Jul-1987 0.12b lmd
	Added keyword-matching code to defmac() that prevents macro definitions
		from overloading mnemonics and directives.

20-Jul-1987 0.12b lmd
	Removed MACROs and MACARGs from symbol table listing.

20-Jul-1987 0.12c lmd
	Added ".undefmac" directive that effectively removes a macro definition
		from the symbol table (does not free its memory, however).

21-Jul-1987 0.12d lmd
	Added "^^macdef <macro-name>" operator (1:macro defined, 0:macro
		has no definition).

24-Jul-1987 0.12e lmd
	Fixed ERROUT and STDOUT declarations for Atari ST (redirection
		was not working correctly).
	Added ^^date and ^^time (current system date and time in DOS
		format).

29-Jul-1987 0.12f lmd
	In 6502 mode, ds.w and ds.l computed the org correctly, but not
		the deposit pointer.

1-Aug-1987 0.12g lmd
	^^date and ^^time needed to be expanded in macros.

6-Aug-1987 0.12h lmd
	Cleanup boilerplate line on listing file; current time and date
		now appear, replacing some unecessary verbiage.

7-Aug-1987 0.12i lmd
	Fixed .ELSE -- IF/ELSE/ENDIF nesting now works correctly.

29-Aug-1987 0.13b lmd
	Added ".GOTO" directive, for leaping around inside macros.

1-Sep-1987 0.13c lmd
	Added, then removed (as a bad idea) .load and .dump.

1-Sep-1987 0.13c lmd
	Put 'as68hack()' inline in tokln().

15-Sep-1987 0.13d lmd
	Fixed bug in forward-referenced FU_QUICK fixups (was stomping
		the byte to fix, not ORing the quick value in).

23-Sep-1987 0.13e lmd
	Made listing non-generation quicker (e.g. lines that are
		.NLIST'd are handled much faster now).

	Symbol table is now listed if assembler was in ".nlist" mode
		at the end of the assembly.

23-Sep-1987 0.13f lmd
	The "as68 hack" stuffs a semi-colon into the line, instead
		of terminating it.

 8-Oct-1987 0.13g lmd
	Some changes I made and then backed out.

12-Oct-1987 0.13h lmd
	Bad range check for "ORA #~$1F" in 6502.c.
	Some cleanup in 6502.c.

12-Oct-1987 0.13i lmd
	Keep symbols starting with 'L'.
	Emit symbols in order of definition.

14-Oct-1987 0.14 lmd
	Backed-out most changes involving emitting symbols in order
		of their definition (it wasn't working, and I don't
		have time to fix AND test the problems).

14-Oct-1987 1.00 lmd
	It's done!  (You really believe that?)
	-> poof! <-
	(The author dissapears in a puff of greasy smoke.  There is
	 a distinct smell of Apple blossoms....)

----------------

15-Oct-1987 1.01 lmd (Back on the ranch...)
	Added configuration and conditional compilation for System V.
	Added 'UNIX' #ifdef (Need to add 'MSDOS' #ifdef, too).
	Floggled around in the Makefile (-DSYSV).

15-Oct-1987 1.02 lmd
	Symbols now appear in the symbol table lexically scoped.
 

   Feb-1988 1.03 lmd
	Check for long forward branches out of range.

   Feb-1988 1.04 lmd
	In non "-6" mode, symbols beginning with 'L' were being
		stripped anyway -- now they are not.

12-May-1988 1.05 lmd
	Minor fix to listings (must advance when outputting 'xx's).

20-Dec-1988 1.07 lmd
	"movem.l (sp)," now complains about a missing register list.
