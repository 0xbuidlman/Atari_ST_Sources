head	1.10;
access;
symbols;
locks
	ersmith:1.10;
comment	@# @;


1.10
date	93.06.15.23.20.42;	author ersmith;	state Exp;
branches;
next	1.9;

1.9
date	93.06.14.23.48.02;	author ersmith;	state Exp;
branches;
next	1.8;

1.8
date	93.06.09.23.47.00;	author ersmith;	state Exp;
branches;
next	1.7;

1.7
date	93.05.12.15.50.18;	author ersmith;	state Exp;
branches;
next	1.6;

1.6
date	93.04.27.23.00.14;	author ersmith;	state Exp;
branches;
next	1.5;

1.5
date	93.04.14.22.19.54;	author ersmith;	state Exp;
branches;
next	1.4;

1.4
date	93.03.12.19.51.12;	author ersmith;	state Exp;
branches;
next	1.3;

1.3
date	93.03.10.20.12.42;	author ersmith;	state Exp;
branches;
next	1.2;

1.2
date	93.03.08.20.07.02;	author ersmith;	state Exp;
branches;
next	1.1;

1.1
date	93.02.24.23.52.46;	author ersmith;	state Exp;
branches;
next	1.0;

1.0
date	93.02.03.21.26.46;	author ersmith;	state Exp;
branches;
next	;


desc
@More trap bindings?
@


1.10
log
@Minor fixups, resource file cleanup etc.
@
text
@*	Trap14.s		02/28/85 - 05/21/85	Derek Mui	
*	combine trap14 trap13 with trp14 and trp13	3/4/86	D.Mui
*	Added save mouse form function	1/6/87	- 1/7/87Derek Mui
*	Take out s68	2/9/88				D.Mui
*	Rename maddr to _maddr		6/25/90		D.Mui
*	Use MAC to assemble		6/28/90		D.Mui
* 	assemble with MAS 900801 kbad (removed zeropage a0 from mediach)
*	Move trap to here		9/5/90		D.Mui
*	Rename to traps.s		9/5/90		D.Mui	
*	Fix at mediach at dooldr 	12/11/90	D.Mui
*	Fix at mediach at remove extra slash at the beginning 4/5/91 D.Mui
*	Add the new names (gemdos, bios, xbios) for trap functions
*	so that we cam get rid of osbind.o 3/10/93	Eric Smith
*	Removed gr_mouse declaration - its not used 3/19/93 C.Gee

	.globl	_trap
	.globl	_gemdos
	.globl	_DOS_AX
	.globl 	_trap14
	.globl	_xbios
	.globl 	_trap13
	.globl	_bios
*	.globl 	_gr_mouse
	.globl 	_getmouse
	.globl 	_putmouse
	.globl 	_LBCOPY
	.globl 	_maddr		; used by gembind:graf_mouse as a flag
	.globl	_kickit

	.text


_kickit:
	move.l	4(a7),d1
	move.w	#201,d0
	trap	#2
	rts


*****************************************
*	AES function to call GEMDOS	*
*****************************************
* For the three trap calls, we now save d2 and a2, since Lattice does
* not preserve them.
* DLF/CJG	3/2/93
*
* The safe way to do this is as follows:

_gemdos:
_trap:
	movem.l	d2/a2,-(sp)
	clr.w	_DOS_AX
	movem.l	12(sp),d0-d2/a0-a2
	movem.l	d0-d2/a0-a2,-(sp)
	trap	#1
	add.l	#24,sp
	move.w	d0,_DOS_AX
	movem.l	(sp)+,d2/a2
	rts


*********************************
*	Trap13 and Trap14 	*
*********************************

_bios:
_trap13:
	movem.l	d2/a2,-(sp)
	movem.l	12(sp),d0-d2/a0-a2
	movem.l	d0-d2/a0-a2,-(sp)
	trap	#13
	add.l	#24,sp
	movem.l	(sp)+,d2/a2
	rts

_xbios:
_trap14:
	movem.l	d2/a2,-(sp)
	movem.l	12(sp),d0-d2/a0-a2
	movem.l	d0-d2/a0-a2,-(sp)
	trap	#14
	add.l	#24,sp
	movem.l	(sp)+,d2/a2
	rts


*********************************
*	Get Mouse		*
*********************************

_getmouse:
	.dc.w	$A000
	suba.l	#$358,a0
	move.l	a0,_maddr		; save the mouse block address
	lea	mform,a1		; destination
	move.w	#36,d0			; size ( - 1 for dbra )
getmcp:
	move.w	(a0)+,(a1)+
	dbra	d0,getmcp
	rts

*********************************
*	Putmouse		*
*********************************

_putmouse:
	lea	mform,a0		; from our form
	move.l	_maddr,a1		; back to the line-a
	move.w	#36,d0			; size ( - 1 for dbra )
putmcp:
	move.w	(a0)+,(a1)+
	dbra	d0,putmcp
	clr.l	_maddr			; no longer in use...
	rts

	.bss
	.even

		.ds.l	1
_maddr:		.ds.l	1
mform:		.ds.w	37
trp13ret:	.ds.l	1
trp14ret:	.ds.l	1
retsav:		.ds.l	1

	.end
@


1.9
log
@Merged in Hans-Martin and Cary's changes
@
text
@@


1.8
log
@Another check in to save work.
@
text
@@


1.7
log
@Check in to save work
@
text
@@


1.6
log
@Merged Cary's and Hans-Martin's changes
@
text
@@


1.5
log
@Incorporated more single/multitasking changes.
@
text
@d14 1
d23 1
a23 1
	.globl 	_gr_mouse
@


1.4
log
@Merged HMK's loadable resource stuff
@
text
@@


1.3
log
@Lattice port
@
text
@d12 2
d16 1
d19 1
d21 1
d48 1
d65 1
d75 1
@


1.2
log
@REAL MultiTOS 1.01
@
text
@d37 4
a40 1

d44 1
d46 1
a46 1
	movem.l	4(sp),d0-d2/a0-a2
d51 1
d60 2
a61 1
	movem.l	4(sp),d0-d2/a0-a2
d65 1
d69 2
a70 1
	movem.l	4(sp),d0-d2/a0-a2
d74 1
@


1.1
log
@1 meg floppy MultiTOS
@
text
@@


1.0
log
@MultiTOS version 1.0
@
text
@@
